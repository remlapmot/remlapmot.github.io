<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Linux | Dr Tom Palmer</title>
    <link>https://remlapmot.github.io/tag/linux/</link>
      <atom:link href="https://remlapmot.github.io/tag/linux/index.xml" rel="self" type="application/rss+xml" />
    <description>Linux</description>
    <generator>Source Themes Academic (https://sourcethemes.com/academic/)</generator><language>en-us</language><lastBuildDate>Tue, 10 Jun 2025 00:00:00 +0000</lastBuildDate>
    <image>
      <url>https://remlapmot.github.io/images/icon_hu_4c69fe6e68a3b4.png</url>
      <title>Linux</title>
      <link>https://remlapmot.github.io/tag/linux/</link>
    </image>
    
    <item>
      <title>Investigating running R on RISC-V thanks to r-base on Ubuntu</title>
      <link>https://remlapmot.github.io/post/2025/riscv-r/</link>
      <pubDate>Tue, 10 Jun 2025 00:00:00 +0000</pubDate>
      <guid>https://remlapmot.github.io/post/2025/riscv-r/</guid>
      <description>&lt;h2 id=&#34;introduction&#34;&gt;Introduction&lt;/h2&gt;
&lt;p&gt;I was interested to see whether and how well R would run on the new RISC-V architecture.&lt;/p&gt;
&lt;p&gt;A while ago I read that RISC-V is now a 
&lt;a href=&#34;https://ubuntu.com/blog/empowering-risc-v-with-open-source-through-ubuntu&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;first class architecture for Ubuntu&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;This got me thinking, instead of having to build R from source maybe the &lt;code&gt;r-base&lt;/code&gt; package might be available for RISC-V. It turns out that this is indeed the case, the architecture we are interested in is &lt;code&gt;riscv64&lt;/code&gt;. The launchpad page for &lt;code&gt;r-base&lt;/code&gt; is 
&lt;a href=&#34;https://launchpad.net/ubuntu/&amp;#43;source/r-base&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;here&lt;/a&gt;. Clicking through the subpages for each version of Ubuntu I can see that R is available for RISC-V from Ubuntu Focal Fossa onwards (for which the version of R is 3.6.3; and the latest version of Ubuntu has the current version of R of 4.5.0).&lt;/p&gt;
&lt;img src=&#34;https://remlapmot.github.io/post/2025/riscv-r/img/questing-r-base-builds.png&#34; alt=&#34;Screenshot of the architectures the r-base package is built for Ubuntu Questing Quokka.&#34; width=&#34;630&#34; style=&#34;display: block; margin: auto;&#34;&gt;
&lt;p&gt;Why do this? I have no immediate need for this. However, there are now quite a few affordable RISC-V single board computers available, and so a similar argument holds to that made by 
&lt;a href=&#34;https://r4pi.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;the R4Pi&lt;/a&gt; (R for the Raspberry Pi project) that running R on such affordable machines is a 
&lt;a href=&#34;https://youtu.be/imYEdQ81JPk?si=B97GQJl846WC6zr3&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;great benefit because it opens R up to a whole new user base and whole new set of low power use cases&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id=&#34;emulating-risc-v-on-an-apple-silicon-mac&#34;&gt;Emulating RISC-V on an Apple Silicon Mac&lt;/h2&gt;
&lt;p&gt;I don&amp;rsquo;t have a RISC-V computer, therefore, I needed to use emulation.&lt;/p&gt;
&lt;p&gt;My setup is that I&amp;rsquo;m on an Apple Silicon M4 MacBook Air. I thought this might be promising to use because this has an ARM processor which is a reduced instruction set architecture, as is RISC-V.&lt;/p&gt;
&lt;p&gt;I wondered whether to try 
&lt;a href=&#34;https://mac.getutm.app/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;UTM&lt;/a&gt; or 
&lt;a href=&#34;https://www.qemu.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;QEMU&lt;/a&gt;. I tried UTM first but I couldn&amp;rsquo;t make any progress. So I found a 
&lt;a href=&#34;https://www.reddit.com/r/RISCV/comments/t19dqz/comment/hyfm8s8/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;tip online&lt;/a&gt; saying that RISC-V Ubuntu could be launched under QEMU on Ubuntu Linux using the following command.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-sh&#34;&gt;qemu-system-riscv64 \
  -machine virt \
  -nographic \
  -m 12288 -smp 4 \
  -bios /usr/lib/riscv64-linux-gnu/opensbi/generic/fw_jump.elf \
  -kernel /usr/lib/u-boot/qemu-riscv64_smode/uboot.elf \
  -device virtio-net-pci,netdev=eth0 \
  -netdev user,id=eth0,hostfwd=tcp::2222-:22 \
  -drive file=ubuntu-24.10-preinstalled-server-riscv64.img,format=raw,if=virtio
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Firstly one needs to obtain the Ubuntu img. Following 
&lt;a href=&#34;https://canonical-ubuntu-boards.readthedocs-hosted.com/en/latest/how-to/qemu-riscv/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;this incredible guide by Canonical&lt;/a&gt; we can choose one of the three versions of Ubuntu listed (Noble, Oracular, and Plucky).&lt;/p&gt;
&lt;p&gt;The image downloads as an &lt;em&gt;.img.xz&lt;/em&gt; archive, which you can extract by installing &lt;code&gt;xz&lt;/code&gt; (I use 
&lt;a href=&#34;https://brew.sh/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Homebrew&lt;/a&gt; for system packages on macOS)&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-sh&#34;&gt;brew install xz
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;and decompressing with&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-sh&#34;&gt;xz --decompress ubuntu-24.10-preinstalled-server-riscv64.img.xz
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The extracted file is about 4GB, but later on I realised I needed a slightly larger harddisk for the virtual machine, so I increased it to 8GB with the following command.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-sh&#34;&gt;qemu-img resize ubuntu-24.10-preinstalled-server-riscv64.img 8G
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I then realised that I needed QEMU on my Mac. Again Homebrew to the rescue with the following command.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-sh&#34;&gt;brew install qemu u-boot-tools
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;(Admittedly I don&amp;rsquo;t think I ended up using the &lt;em&gt;u-boot-tools&lt;/em&gt;.) Next I needed the two files; &lt;em&gt;fw_jump.elf&lt;/em&gt; and &lt;em&gt;uboot.elf&lt;/em&gt;. I had a look in &lt;em&gt;/opt/homebrew/Cellar/qemu/10.0.2/&lt;/em&gt; but I couldn&amp;rsquo;t work out if they are in there or not (there are some zip archives in some subdirectories). There are some official documentation pages 
&lt;a href=&#34;https://risc-v-getting-started-guide.readthedocs.io/en/latest/linux-qemu.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;here&lt;/a&gt; and 
&lt;a href=&#34;https://risc-v-getting-started-guide.readthedocs.io/en/latest/linux-qemu.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;here&lt;/a&gt; but I couldn&amp;rsquo;t follow them. I then found a comment that said you can 
&lt;a href=&#34;https://www.reddit.com/r/RISCV/comments/t19dqz/comment/hyfaeh4/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;copy them from an Ubuntu installation&lt;/a&gt;, which I implemented in Docker.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-sh&#34;&gt;docker run -it --rm --platform linux/arm64 \
  -v $PWD:/home ubuntu:24.04 bash /home/copy-files.sh
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;where &lt;em&gt;copy-files.sh&lt;/em&gt; contains&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-sh&#34;&gt;apt update
apt upgrade -y 
apt install -y opensbi qemu-system-misc u-boot-qemu
cp /usr/lib/u-boot/qemu-riscv64_smode/uboot.elf /home/uboot.elf
cp /usr/lib/riscv64-linux-gnu/opensbi/generic/fw_jump.elf /home/fw_jump.elf
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This saves the two files to the current working directory, so I could modify my call to &lt;code&gt;qemu-system-riscv64&lt;/code&gt; to be as follows.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-sh&#34;&gt;qemu-system-riscv64 \
  -machine virt \
  -nographic \
  -m 12288 -smp 4 \
  -bios fw_jump.elf \
  -kernel uboot.elf \
  -device virtio-net-pci,netdev=eth0 \
  -netdev user,id=eth0,hostfwd=tcp::2222-:22 \
  -drive file=ubuntu-24.10-preinstalled-server-riscv64.img,format=raw,if=virtio
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;After a couple of seconds you obtain a GRUB screen in which you select the default of &lt;em&gt;Ubuntu&lt;/em&gt;. Then after a further approx. 20 seconds of screen output, a little bit to my surprise this worked and I was presented with the login screen to Ubuntu server. The default username is &lt;em&gt;ubuntu&lt;/em&gt; and the default password is &lt;em&gt;ubuntu&lt;/em&gt;. On login you are immediately prompted to change the password but then you&amp;rsquo;re in.&lt;/p&gt;
&lt;img src=&#34;https://remlapmot.github.io/post/2025/riscv-r/img/ubuntu-launch-screen.png&#34; alt=&#34;Screenshot of the Ubuntu server startup message running on an emulated RISC-V virtual machine.&#34; width=&#34;630&#34; style=&#34;display: block; margin: auto;&#34;&gt;
&lt;p&gt;So next it&amp;rsquo;s essentially standard Ubuntu commands to update the system and install &lt;code&gt;r-base&lt;/code&gt;. I also install &lt;code&gt;r-base-dev&lt;/code&gt; to obtain the necessary compilers to build any source packages containing code which needs to be compiled.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;sudo apt-get update
sudo apt-get upgrade -y
sudo apt-get install -y r-base r-base-dev
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Then we launch R.&lt;/p&gt;
&lt;img src=&#34;https://remlapmot.github.io/post/2025/riscv-r/img/r-startup-message.png&#34; alt=&#34;Screenshot of the R startup message running on an emulated RISC-V virtual machine.&#34; width=&#34;630&#34; style=&#34;display: block; margin: auto;&#34;&gt;
&lt;p&gt;From this point on everything I tried simply worked. I installed &lt;em&gt;data.table&lt;/em&gt; from source. Then slightly more obscurely, I tried out a trick from Jeroen Ooms who said that if an R package only contains R code then its binary version will install under any architecture. I have a few R packages in my r-universe that only contain R code, my example installed as expected (note this was built on x86_64 Ubuntu Linux but contains no source code which needs to be compiled).&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;install.packages(&#39;tmsens&#39;, repos =
  &#39;https://remlapmot.r-universe.dev/bin/linux/noble-x86_64/4.5/&#39;)
#&amp;gt; * installing *binary* package ‘tmsens’ ...
#&amp;gt; * DONE (tmsens)
#&amp;gt; 
#&amp;gt; The downloaded source packages are in
#&amp;gt; 	‘/tmp/RtmpYqwF8W/downloaded_packages’
library(tmsens)
#&amp;gt; Warning message:
#&amp;gt; package ‘tmsens’ was built under R version 4.5.0
help(package = &#39;tmsens&#39;)
#&amp;gt; 
#&amp;gt;                 Information on package ‘tmsens’
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I admit I haven&amp;rsquo;t tried many features here but I am really impressed with Ubuntu packages being available for RISC-V.&lt;/p&gt;
&lt;p&gt;Once you are finished using R, exit R as usual and to shutdown the Ubuntu server issue the following.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-sh&#34;&gt;sudo poweroff
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;summary&#34;&gt;Summary&lt;/h2&gt;
&lt;p&gt;I have shown how to install and run R on Ubuntu Server for RISC-V under QEMU emulation. Thanks to Canonical&amp;rsquo;s support for RISC-V and the maintainers of the &lt;code&gt;r-base&lt;/code&gt; and related packages the experience of running R on RISC-V is already excellent.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Make your own CRAN-like repository with Linux binary R packages</title>
      <link>https://remlapmot.github.io/post/2022/make-linux-binary-cran-like-repo/</link>
      <pubDate>Wed, 30 Nov 2022 00:00:00 +0000</pubDate>
      <guid>https://remlapmot.github.io/post/2022/make-linux-binary-cran-like-repo/</guid>
      <description>&lt;style type=&#34;text/css&#34;&gt;
.lineheightone {
  line-height: 1.29;
  font-variant-ligatures: normal;
  font-feature-settings: normal;
}
&lt;/style&gt;
&lt;h2 id=&#34;introduction&#34;&gt;Introduction&lt;/h2&gt;
&lt;p&gt;CRAN is a fantastic resource, in particular because it provides binary packages for Windows and macOS (for both Intel and Apple Silicon Macs). Because there are so many Linux distributions CRAN does not provide binary packages for Linux. Therefore, installing R packages on Linux can be slow because the bundled source packages need to be built on users machines.&lt;/p&gt;
&lt;p&gt;But let&amp;rsquo;s install a package from the Posit (formerly RStudio) Package Manager on Ubuntu Linux.
&lt;img src=&#34;https://remlapmot.github.io/post/2022/make-linux-binary-cran-like-repo/img/rstudio-install-tidyverse-rspm-linux-binary.png&#34; alt=&#34;Installing binary Linux tidyverse package using Posit Package Manager.&#34; style=&#34;display: block; margin: auto;&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Woah!&lt;/em&gt;&lt;/strong&gt; Something magical just happened, we installed a binary R package on Linux! How did that happen, let&amp;rsquo;s find out.&lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;p&gt;Note, obtaining the binary package from the public Posit package manager relies on the R session&amp;rsquo;s &lt;code&gt;HTTPUserAgent&lt;/code&gt; option being set. As I understand it, this is set automatically within an RStudio/RStudio Server session. If you are using R in the terminal you can set this with the following code (if you don&amp;rsquo;t have this option set you will obtain the source version of the package).&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;options(HTTPUserAgent =
  sprintf(
    &amp;quot;R/%s R (%s)&amp;quot;, getRversion(), paste(getRversion(),
    R.version[&amp;quot;platform&amp;quot;], R.version[&amp;quot;arch&amp;quot;], R.version[&amp;quot;os&amp;quot;])
  )
)
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;building-bundled-source-and-binary-packages&#34;&gt;Building bundled source and binary packages&lt;/h2&gt;
&lt;p&gt;I will use an example of one of my own packages &lt;strong&gt;OneSampleMR&lt;/strong&gt;. I am running RStudio server on Ubuntu Linux, Focal Fossa through Windows Subsystem for Linux.&lt;/p&gt;
&lt;p&gt;The package sources are in a Git repository hosted on GitHub, 
&lt;a href=&#34;https://github.com/remlapmot/OneSampleMR&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;here&lt;/a&gt;. There is an &lt;code&gt;.Rproj&lt;/code&gt; file, which we open in RStudio as a project.&lt;/p&gt;
&lt;p&gt;To build an R package we require all of its dependency packages are installed, so we install those with &lt;code&gt;devtools::install_dev_deps()&lt;/code&gt; and if your package requires any system libraries those must be installed too.&lt;/p&gt;
&lt;p&gt;The Build pane gives us two convenient options, which will build either the bundled source package or binary package through calls to &lt;code&gt;devtools::build()&lt;/code&gt;.
&lt;img src=&#34;https://remlapmot.github.io/post/2022/make-linux-binary-cran-like-repo/img/rstudio-build-pane-build-options.png&#34; alt=&#34;Screenshot of build pane options for building bundled source and binary packages.&#34; style=&#34;display: block; margin: auto;&#34;&gt;&lt;/p&gt;
&lt;p&gt;Clicking on both in turn we see the following.
&lt;img src=&#34;https://remlapmot.github.io/post/2022/make-linux-binary-cran-like-repo/img/rstudio-build-source-package.png&#34; alt=&#34;Screenshot of building a bundled source package in RStudio.&#34; style=&#34;display: block; margin: auto;&#34;&gt;&lt;/p&gt;
&lt;img src=&#34;https://remlapmot.github.io/post/2022/make-linux-binary-cran-like-repo/img/rstudio-build-binary-package.png&#34; alt=&#34;Screenshot of building a binary package in RStudio.&#34; style=&#34;display: block; margin: auto;&#34;&gt;
&lt;p&gt;The bundled source package has been built as &lt;code&gt;OneSampleMR_0.1.2.tar.gz&lt;/code&gt; and the binary package has been built as &lt;code&gt;OneSampleMR_0.1.2_R_x86_64-pc-linux-gnu.tar.gz&lt;/code&gt;. Both files are in the directory above the project.&lt;/p&gt;
&lt;p&gt;We can achieve the same output by making direct calls to &lt;code&gt;R CMD build&lt;/code&gt; and &lt;code&gt;R CMD install --build&lt;/code&gt; in a shell if preferred. We can test that these install as follows.&lt;/p&gt;
&lt;img src=&#34;https://remlapmot.github.io/post/2022/make-linux-binary-cran-like-repo/img/rstudio-install-source-package.png&#34; alt=&#34;Screenshot of installing a bundled source package in RStudio.&#34; style=&#34;display: block; margin: auto;&#34;&gt;
&lt;img src=&#34;https://remlapmot.github.io/post/2022/make-linux-binary-cran-like-repo/img/rstudio-install-binary-package.png&#34; alt=&#34;Screenshot of installing a binary package in RStudio.&#34; style=&#34;display: block; margin: auto;&#34;&gt;
&lt;h2 id=&#34;cran-structure-for-bundled-source-package-files&#34;&gt;CRAN structure for bundled source package files&lt;/h2&gt;
&lt;p&gt;In two excellent blog posts Marks Sellors describes how to make a CRAN-like repository.&lt;sup id=&#34;fnref:2&#34;&gt;&lt;a href=&#34;#fn:2&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;p&gt;To host bundled source packages, such as our &lt;code&gt;OneSampleMR_0.1.2.tar.gz&lt;/code&gt; file, we require the following directory structure (noting that the &lt;code&gt;latest&lt;/code&gt; directory is optional, but allows us to add snapshot directories if we wanted to).&lt;/p&gt;
&lt;!-- # brew install tree --&gt;
&lt;!-- tree ~/Documents/GitHub/cran/site -d -I &#39;__linux__|bin&#39; --noreport --&gt;
&lt;pre&gt;&lt;code class=&#34;language-plaintext{.lineheightone}&#34;&gt;/mycran
└── latest
    └── src
        └── contrib
            └── 4.3.0
                └── Recommended
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Specifically, we place the &lt;code&gt;{package}_{version}.tar.gz&lt;/code&gt; files into the &lt;code&gt;.../src/contrib&lt;/code&gt; directory. In that directory we then run&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;tools::write_PACKAGES(type = &amp;quot;source&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;which generates 3 additional files (&lt;code&gt;PACKAGES&lt;/code&gt;, &lt;code&gt;PACKAGES.gz&lt;/code&gt;, and &lt;code&gt;PACKAGES.rds&lt;/code&gt;) which R will use to query what packages are available in our repository when its served on the web.&lt;/p&gt;
&lt;h2 id=&#34;adding-windows-and-macos-binary-r-packages&#34;&gt;Adding Windows and macOS binary R packages&lt;/h2&gt;
&lt;p&gt;We saw above how to build a binary Linux package. The same process, when repeated on Windows will generate a file called &lt;code&gt;{package}_{version}.zip&lt;/code&gt; and &lt;code&gt;{package}_{version}.tgz&lt;/code&gt; on macOS (on Macs with both Intel and Apple Silicon processors).&lt;/p&gt;
&lt;p&gt;Assuming that we have some of these files we need to know where to put them. Since CRAN distributes binary packages for Windows and macOS we follow their directory structure, which is as follows.&lt;/p&gt;
&lt;!-- brew install tree --&gt;
&lt;!-- tree ~/Documents/GitHub/cran/site -d -I &#39;__linux__&#39; --noreport --&gt;
&lt;pre&gt;&lt;code class=&#34;language-plaintext{.lineheightone}&#34;&gt;/mycran
└── latest
    ├── bin
    │   ├── macosx
    │   │   ├── big-sur-arm64
    │   │   │   └── contrib
    │   │   │       └── 4.2
    │   │   └── contrib
    │   │       └── 4.2
    │   └── windows
    │       └── contrib
    │           └── 4.2
    └── src
        └── contrib
            └── 4.3.0
                └── Recommended
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Noting that the current version of R is 4.2.2 and that the relevant directory name with the minor version number changes when R&amp;rsquo;s current minor version number changes, we place&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;macOS arm64 binary packages (for Macs with Apple Silicon processors) into the &lt;code&gt;.../bin/macosx/big-sur-arm64/contrib/4.2/&lt;/code&gt; directory&lt;/li&gt;
&lt;li&gt;macOS x86_64 binary packages (for Macs with Intel processors) into the &lt;code&gt;.../bin/macosx/contrib/4.2/&lt;/code&gt; directory, and&lt;/li&gt;
&lt;li&gt;Windows binary packages into the &lt;code&gt;.../bin/windows/contrib/4.2/&lt;/code&gt; directory.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;We then run &lt;code&gt;tools::write_PACKAGES(type = &amp;quot;mac.binary&amp;quot;)&lt;/code&gt; (changing to &lt;code&gt;type = &amp;quot;win.binary&amp;quot;&lt;/code&gt; as required) in each of these directories to generate the 3 &lt;code&gt;PACKAGES&lt;/code&gt; files.&lt;/p&gt;
&lt;p&gt;We can confirm this directory structure using the &lt;code&gt;contrib.url()&lt;/code&gt; function (the last command below was run on an Apple Silicon Mac).&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;contrib.url(&amp;quot;&amp;quot;, type = &amp;quot;source&amp;quot;)
## [1] &amp;quot;/src/contrib&amp;quot;
contrib.url(&amp;quot;&amp;quot;, type = &amp;quot;win.binary&amp;quot;)
## [1] &amp;quot;/bin/windows/contrib/4.2&amp;quot;
contrib.url(&amp;quot;&amp;quot;, type = &amp;quot;mac.binary&amp;quot;)
## [1] &amp;quot;/bin/macosx/contrib/4.2&amp;quot;
contrib.url(&amp;quot;&amp;quot;, type = &amp;quot;binary&amp;quot;)
## [1] &amp;quot;/bin/macosx/big-sur-arm64/contrib/4.2&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;And they are also listed in the R Installation and Administration manual.&lt;sup id=&#34;fnref:3&#34;&gt;&lt;a href=&#34;#fn:3&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;3&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;p&gt;On Apple Silicon Macs the &lt;code&gt;big-sur-arm64&lt;/code&gt; filepath corresponds to the end of &lt;code&gt;.Platform$pkgType&lt;/code&gt;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;.Platform$pkgType
## [1] &amp;quot;mac.binary.big-sur-arm64&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;where-to-store-and-how-to-name-linux-binary-r-packages&#34;&gt;Where to store and how to name Linux binary R packages?&lt;/h2&gt;
&lt;p&gt;CRAN does not distribute Linux binary packages and so there is no directory structure from them to copy.&lt;/p&gt;
&lt;p&gt;However both the Posit Package Manager and the 
&lt;a href=&#34;https://r4pi.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;R4Pi&lt;/a&gt; project achieve this in a very clever way.&lt;sup id=&#34;fnref:4&#34;&gt;&lt;a href=&#34;#fn:4&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;4&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;p&gt;We saw above that on Linux bundled source packages have filenames of the form &lt;code&gt;{package}_{version}.tar.gz&lt;/code&gt; whereas the binary package filenames are of the form &lt;code&gt;{package}_{version}_R_x86_64-pc-linux-gnu.tar.gz&lt;/code&gt; (the text after &lt;code&gt;{package}_{version}_&lt;/code&gt; may be different depending on your machine and distro).&lt;/p&gt;
&lt;p&gt;To distribute the Linux binary packages we create a parallel directory structure, which takes the same form as for the bundled source packages. In the case of Ubuntu Focal Fossa the Posit Package Manager uses &lt;code&gt;__linux__/focal/latest/src/contrib&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;They then rename the &lt;code&gt;{package}_{version}_R_x86_64-pc-linux-gnu.tar.gz&lt;/code&gt; files to the same form as the bundled source package files, i.e., to &lt;code&gt;{package}_{version}.tar.gz&lt;/code&gt;. And they put them in this new &lt;code&gt;src/contrib&lt;/code&gt; directory.&lt;/p&gt;
&lt;p&gt;The structure of our CRAN-like repository (well in fact our 2 parallel repositories) is now.&lt;/p&gt;
&lt;!-- tree ~/Documents/GitHub/cran/site -d -I &#39;jammy&#39; --noreport --&gt;
&lt;pre&gt;&lt;code class=&#34;language-plaintext{.lineheightone}&#34;&gt;/mycran
├── __linux__
│   └── focal
│       └── latest
│           └── src
│               └── contrib
│                   └── 4.3.0
│                       └── Recommended
└── latest
    ├── bin
    │   ├── macosx
    │   │   ├── big-sur-arm64
    │   │   │   └── contrib
    │   │   │       └── 4.2
    │   │   └── contrib
    │   │       └── 4.2
    │   └── windows
    │       └── contrib
    │           └── 4.2
    └── src
        └── contrib
            └── 4.3.0
                └── Recommended
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;We then run&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;tools::write_PACKAGES(type = &amp;quot;source&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;in the &lt;code&gt;.../__linux__/distro-name/src/contrib&lt;/code&gt; directory for each Linux distribution to generate the &lt;code&gt;PACKAGES&lt;/code&gt; files.&lt;/p&gt;
&lt;p&gt;Once this directory structure is served we can set our repository in R to &lt;code&gt;.../__linux__/focal/latest&lt;/code&gt; and R will find the binary package &lt;code&gt;{package}_{version}.tar.gz&lt;/code&gt; files in the &lt;code&gt;...__linux__/focal/src/contrib/&lt;/code&gt; directory, as per the first figure in this post.&lt;/p&gt;
&lt;p&gt;Note that the &lt;code&gt;{package}_{version}.tar.gz&lt;/code&gt; files within &lt;code&gt;__linux__/focal/latest/src/contrib&lt;/code&gt; do not all have to be of binary packages. They can be a mix of bundled source and binary packages, which is helpful if you haven&amp;rsquo;t had time to build all your binary package files.&lt;/p&gt;
&lt;p&gt;We can also confirm that on Ubuntu Focal Fossa&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;.Platform$pkgType
## [1] &amp;quot;source&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;therefore, on Linux, &lt;code&gt;utils:::resolvePkgType()&lt;/code&gt; always returns &lt;code&gt;&amp;quot;source&amp;quot;&lt;/code&gt;. Hence, on Linux, &lt;code&gt;contrib.url()&lt;/code&gt; always returns &lt;code&gt;/src/contrib&lt;/code&gt; regardless of its &lt;code&gt;type&lt;/code&gt; argument.&lt;/p&gt;
&lt;h2 id=&#34;testing-your-cran-like-repositories-locally&#34;&gt;Testing your CRAN-like repositories locally&lt;/h2&gt;
&lt;p&gt;You can either run a local web server or use the &lt;code&gt;file://...&lt;/code&gt; URL notation as your &lt;code&gt;repos&lt;/code&gt; global options setting (set with &lt;code&gt;option(repos = ...)&lt;/code&gt; or as the &lt;code&gt;repos&lt;/code&gt; argument to &lt;code&gt;install.packages()&lt;/code&gt;).&lt;/p&gt;
&lt;p&gt;Here&amp;rsquo;s a screenshot of installing a binary package on Ubuntu Focal Fossa.
&lt;img src=&#34;https://remlapmot.github.io/post/2022/make-linux-binary-cran-like-repo/img/cran-like-focal-example.png&#34; alt=&#34;Screenshot of testing a CRAN-like repository on Ubuntu Focal Fossa.&#34; style=&#34;display: block; margin: auto;&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;summary&#34;&gt;Summary&lt;/h2&gt;
&lt;p&gt;We have taken a look at the structure of a CRAN-like repository and built bundled source and binary package files. We saw that the trick for distributing Linux binary packages is to make a parallel directory with the same structure as that required for bundled source packages and that we need to rename the binary package files to have the same filename format as the bundled source package files.&lt;/p&gt;
&lt;div class=&#34;footnotes&#34; role=&#34;doc-endnotes&#34;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&#34;fn:1&#34;&gt;
&lt;p&gt;Note that there are other approaches to distributing binary R packages on Linux, see 
&lt;a href=&#34;https://cran.r-project.org/bin/linux/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://cran.r-project.org/bin/linux/&lt;/a&gt; and links therein, 
&lt;a href=&#34;https://eddelbuettel.github.io/r2u/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://eddelbuettel.github.io/r2u/&lt;/a&gt;, and 
&lt;a href=&#34;https://enchufa2.github.io/bspm/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://enchufa2.github.io/bspm/&lt;/a&gt;.&amp;#160;&lt;a href=&#34;#fnref:1&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:2&#34;&gt;
&lt;p&gt;
&lt;a href=&#34;https://blog.sellorm.com/2019/03/29/lifting-the-lid-on-cran/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://blog.sellorm.com/2019/03/29/lifting-the-lid-on-cran/&lt;/a&gt; and 
&lt;a href=&#34;https://blog.sellorm.com/2019/03/30/build-your-own-cran-like-repo/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://blog.sellorm.com/2019/03/30/build-your-own-cran-like-repo/&lt;/a&gt;] There is also the 
&lt;a href=&#34;https://cran.r-project.org/package=miniCRAN&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;strong&gt;miniCRAN&lt;/strong&gt;&lt;/a&gt; package to help do this, but we don&amp;rsquo;t need to use this for the following explanation.&amp;#160;&lt;a href=&#34;#fnref:2&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:3&#34;&gt;
&lt;p&gt;See 
&lt;a href=&#34;https://cran.r-project.org/doc/manuals/R-admin.html#Setting-up-a-package-repository&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://cran.r-project.org/doc/manuals/R-admin.html#Setting-up-a-package-repository&lt;/a&gt;.&amp;#160;&lt;a href=&#34;#fnref:3&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:4&#34;&gt;
&lt;p&gt;See 
&lt;a href=&#34;https://packagemanager.rstudio.com/client/#/repos/2/overview&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://packagemanager.rstudio.com/client/#/repos/2/overview&lt;/a&gt; and 
&lt;a href=&#34;https://pkgs.r4pi.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://pkgs.r4pi.org/&lt;/a&gt;&amp;#160;&lt;a href=&#34;#fnref:4&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
</description>
    </item>
    
  </channel>
</rss>
