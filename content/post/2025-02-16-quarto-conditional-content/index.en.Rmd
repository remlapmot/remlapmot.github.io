---
title: "Programmatically conditional content inclusion and exclusion for Quarto documents using any language allowing inline code"
author: Package Build
date: '2025-02-16'
slug: quarto-conditional-content
categories:
  - Blog
tags:
  - Quarto
  - R
  - R Markdown
  - Stata
  - Python
  - Julia
  - Jupyter
subtitle: ''
summary: ""
authors: []
lastmod: '2025-02-16T12:00:00+00:00'
featured: no
image:
  caption: ''
  focal_point: 'Center'
  preview_only: no
  alt_text: 'Screenshot of programmatically including conditional content in a Quarto document using the Jupyter python3 engine.'
projects: []
toc: true
---

## Introduction

Inline code has been a feature of knitr/rmarkdown for a while. Yihui Xie and Christophe Devreux have used it to pull off some fantastic tricks. My favourite is using it to write out R Markdown/Markdown code within an R Markdown document. The following example is from the R Markdown Cookbook (TODO: find example, add URL).

````{verbatim, lang="markdown"}
`r if knitr::is_pdf_output() some_code_to_run_when_rendering_to_pdf`
````

My interest in this lies in creating tutoral/exercises to students in which my aim is to have a single R Markdown file which can render both the questions document and a document with the solutions.

I wrote a little package, [**knitexercise**](https://remlapmot.github.io/knitexercise/) to help with this.

## Conditional content in Quarto

### R: knitr

Yihui Xie and Christophe Devreux style approach. We toggle

````{verbatim, lang="markdown"}
---
title: "Example exercise"
author: "My Name"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(include = FALSE) # change to TRUE when knitting solutions
```

1. This is question 1. Which might have some R code you always want to show.
   ```{r, include=TRUE}
   # example code for the question
   ```

   ```{asis}
   Paragraph text for the solution can be kept in the document in an `asis` chunk.
   And solution R code in an `r` chunk.
   Both of these will use the `include` value from the `setup` chunk.
   ```
    
   ```{r}
   # example code for the solution
   ```

2. This is question 2.
````

### R: Quarto

[Nicola Rennie approach](https://nrennie.rbind.io/blog/r-tutorial-worksheets-quarto/) is to use the inline code to write out Quarto's [conditional content classes](https://quarto.org/docs/authoring/conditional.html).

````{verbatim, lang="markdown"}
---
params: 
  hide_answers: true
---

`r if (params$hide_answers) "::: {.content-hidden}"`

Text and code for answer

`r if (params$hide_answers) ":::"`
````

### Python

````{verbatim, lang="markdown"}
---
format: html
---

```{python}
#| tags: [parameters]
hide_answers = True
```

```{python}
#| include: false
from IPython.display import Markdown
```

`{python} Markdown("::: {.content-hidden}") if hide_answers else None`

```{python}
print("Hidden")
```

`{python} Markdown(":::") if hide_answers else None`
````

### Stata

The Stata case is trickier. The nbstata Jupyter kernel allows inline code, however this must be a `display` command, so we cannot write the if statement within the inline code. This is overcome by saving the different strings at the top of the document. Also we cannot use local macros within inline code, so we use scalars.

````{verbatim, lang="markdown"}
---
format:
  html:
    embed-resources: true
jupyter: nbstata
---

```{stata}
*| include: false
scalar hide_solutions_open = "::: {.content-hidden}"
scalar hide_solutions_close = ":::"
scalar show_solutions = " "
```

`{stata} scalar(hide_solutions_open)`

```{stata}
display "Hidden"
```

`{stata} scalar(hide_solutions_close)`

`{stata} scalar(show_solutions)`

```{stata}
display "Shown"
```

`{stata} scalar(show_solutions)`
````

### Julia

````{verbatim, lang="markdown"}
---
format:
  html:
    embed-resources: true
engine: julia
---

```{julia}
#| include: false
using Markdown
hide_solutions = true
```

`{julia} hide_solutions ? md"::: {.content-hidden}" : md""`

```{julia}
println("Hidden")
```

`{julia} hide_solutions ? md":::" : md""`

```{julia}
println("Shown")
```
````

## Parameterised reports

An amazing feature of **knitr** is that chunk options can be R expressions.

Remarkably we can also do this with a pure Quarto approach with the [`! expr ...` YAML tag literal](https://quarto.org/docs/tools/rstudio.html#knitr-engine). This can be followed by R code which evaluates to a single YAML flow scalar.

[Quarto parameters](https://quarto.org/docs/computations/parameters.html)

As far as I am aware, this is not yet possible for any other Quarto engine. However, passing the parameter values to our inline code above means that we can effectively achieve parameterised conditional content in a Quarto document for the jupyter python3 engine.

````{verbatim, lang="markdown"}
TODO
```` 

## Summary

I have shown how to programmatically include conditional content for several different Quarto engines using inline code. I have also shown how the jupyter python3 engine can use this with parameterised Quarto documents.
