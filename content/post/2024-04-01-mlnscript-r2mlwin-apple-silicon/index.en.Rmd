---
title: 'Running MLwiN using mlnscript via the R2MLwiN R package on Apple Silicon Macs '
author: Tom Palmer
date: '2024-04-02'
slug: mlnscript-r2mlwin-apple-silicon
categories:
  - Blog
tags:
  - R
  - MLwiN
subtitle: ''
summary: 'How to run MLwiN natively on Apple Silicon Macs via R and the R2MLwiN package.'
authors: []
lastmod: '2024-04-01T20:18:00+01:00'
featured: no
draft: no
image:
  caption: ''
  focal_point: 'Centre'
  preview_only: no
projects: []
bibliography: refs.bib
link-citations: true
---

```{r include=FALSE}
knitr::opts_chunk$set(
  message = FALSE,
  warning = FALSE,
  collapse = TRUE,
  comment = '#>'
)
```

## Introduction

MLwiN from the Centre for Multilevel Modelling at the University of Bristol (where disclaimer, I also work) is a fantastic piece of software.[@mlwin] The name suggests it only works on Windows. As we'll find out this isn't the case.

In the past this was sort of true because to make it work on a Mac with an Intel processor one would need to run it using [Wine](https://www.winehq.org/) (I'm assuming it would also work on x86_64 Linux under Wine, although I admit I haven't tried that).

CMM have cleverly made the MLwiN libraries available natively for other operating systems. The files for macOS are universal binaries which means that they run natively on both Intel and Apple Silicon Macs. Let's find out how to set this up.^[This post is essentially a more detailed explanation of the advice given on the MLwiN website, [here](https://www.bristol.ac.uk/cmm/software/support/support-faqs/commands-macros.html) and [here](https://www.bristol.ac.uk/cmm/software/mlwin/features/sysreq.html#unix).]

## Setting up MLwiN on an Apple Silicon Mac

* Obtain the `MLN.dmg` installer from the Centre for Multilevel Modelling and install it. See the relevant download page (depending upon whether you are an academic) on the MLwiN [website](https://www.bristol.ac.uk/cmm/software/mlwin/).
* On macOS it is recommended to install the files into the _/opt/mln/_ directory, which you will need to create with Admin permissions, or install to another directory if you don't have Admin permissions.
* Once installed we can check that _mlnscript_ and _libmln.dylib_ are universal binaries,

  ```{bash}
  lipo -archs /opt/mln/mlnscript
  ```

  ```{bash}
  lipo -archs /opt/mln/libmln.dylib
  ```

  since both architectures are listed this indicates both files are universal binaries. Apple Silicon Macs will use the arm64 architecture.
* Now we need to grant the two files permission to run. To do this run in the Terminal app

  ```bash
  /opt/mln/mlnscript --version
  ```

  which will fail with a pop-up similar to the following.

  <img src="/post/2024/mlnscript-r2mlwin-apple-silicon/img/security-warning.png" alt="Screenshot of macOS security warning pop-up." style="display: block; margin: auto;">

  Click *Cancel* and then go into the *System settings...* | *Privacy & Security* and scroll down and click *Allow Anyway*

  <img src="/post/2024/mlnscript-r2mlwin-apple-silicon/img/mlnscript-security.png" alt="Screenshot of macOS privacy and security setting." style="display: block; margin: auto;">

  Do the same for *libmln.dylib*.

* We can then check it's running with

  ```{bash}
  /opt/mln/mlnscript --version
  ```

  which should output the version number, which is currently 3.10.

* In R we then install the **R2MLwiN** package from CRAN.[@r2mlwin]

  ```r
  install.packages("R2MLwiN")
  ```

* For an example we could run one of the demos in the package, which we can list with

  ```r
  demo(package = "R2MLwiN")
  ```

  Then run one, for example

  ```{r}
  library(R2MLwiN)
  # if you did not install mlnscript in /opt/mln , set:
  # options(MLwiN_path = "/path-to/mlnscript")
  demo(UserGuide02)
  ```

## Summary

Despite having *Win* in its name, the core libraries for running MLwiN on other operating systems (and indeed with other architectures), including macOS for both Intel and Apple Silicon processors and various Linux and Unix distributions (Debian, Fedora, FreeBSD, Rocky, and Ubuntu), have been available for sometime and are straightforward to use from R via the **R2MLwiN** package.

## References
